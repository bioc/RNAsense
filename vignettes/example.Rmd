---
title: "Vignette for RNAsense package"
output: rmarkdown::html_vignette
fig_width: 8 
fig_height: 6
vignette: >
  %\VignetteIndexEntry{Put the title of your vignette here}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages, echo = FALSE}
require(ggplot2)
require(parallel)
require(NBPSeq)
require(qvalue)
```

```{r read data}
startTime <- Sys.time() # get start time
analyzeConditions <- c("WT", "MZsox")
ini <- TRUE

mydata <- read.csv("zv9_Refseq_WT_MZsox.csv", sep="\t")
# mydata is data in standard format
thCount <- 100
nrcores <- 4
genenames <- mydata$genename

vec2Keep <- which(sapply(1:dim(mydata)[1],function(i) !Reduce("&",mydata[i,3:dim(mydata)[2]]<thCount)))
mydata <- mydata[vec2Keep,]
genenames <- genenames[vec2Keep]
times <- sort(unique(as.numeric(do.call(rbind,strsplit(names(mydata)[-c(1,2)], "_"))[,2])))

# apply fold change detection
resultFC <- RNAsense:::getFC(dataset = mydata, myanalyzeConditions = analyzeConditions, cores = nrcores, mytimes = times)

# generate and output vulcano plot
ggplot(subset(resultFC, !is.na(FCdetect)), aes(x=logFoldChange, y=-log10(pValue), color=FCdetect)) + xlab("log2(Fold Change)") + geom_point(shape=20)

# apply switch detection
resultSwitch <- RNAsense:::getSwitch(dataset = mydata, cores = nrcores)
# collect results
resultCombined <- RNAsense:::combineResults(resultSwitch, resultFC)

RNAsense:::plotSSGS(resultCombined, c(2.5,3,3.5,4,4.5,5,5.5))

#Output gene switch tables
#RNAsense:::outputGeneTables(resultCombined)

endTime <- Sys.time() # get end time
cat(paste0("Finished with Running Time: ", round(as.numeric(as.difftime(endTime-startTime, units = "mins")), digits = 2), " minutes")) 
```
